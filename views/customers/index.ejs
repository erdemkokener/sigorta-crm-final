<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
  <h1 class="h2"><%= birthdaysFilter ? 'Doğum Günü Olan Müşteriler' : 'Müşteriler' %></h1>
  <div class="btn-toolbar mb-2 mb-md-0">
    <div class="btn-group me-2">
      <a href="/customers/export.xlsx" class="btn btn-sm btn-outline-secondary"><i class="bi bi-file-earmark-excel"></i> Excel'e Aktar</a>
      <a href="/policies" class="btn btn-sm btn-outline-secondary"><i class="bi bi-file-text"></i> Poliçeler</a>
    </div>
    <a href="/customers?birthdays=today" class="btn btn-sm btn-outline-success me-2"><i class="bi bi-gift"></i> Doğum Günü Olanlar</a>
    <a href="/customers/new" class="btn btn-sm btn-primary"><i class="bi bi-person-plus"></i> Yeni Müşteri</a>
  </div>
</div>

<% if (birthdaysFilter && customers.length > 0) { %>
  <div class="alert alert-success d-flex justify-content-between align-items-start">
    <div>
      <div class="fw-bold mb-1">Bugün doğum günü olan müşteriler</div>
      <ul class="mb-0">
        <% customers.forEach(c => { %>
          <li>
            <strong><%= c.name %></strong>
            <% if (c.phone) { %>
              -
              <a
                href="https://wa.me/<%= String(c.phone || '').replace(/\D/g, '') %>?text=<%= encodeURIComponent('Sayın ' + (c.name || '') + ', doğum gününüzü kutlar, sağlıklı günler dileriz. Erdem KÖKENER Sigorta WİN') %>"
                target="_blank"
              >
                WhatsApp ile mesaj gönder
              </a>
            <% } else { %>
              - Telefon numarası kayıtlı değil
            <% } %>
          </li>
        <% }) %>
      </ul>
    </div>
  </div>
<% } %>

<div class="card mb-4 shadow-sm">
  <div class="card-body">
    <form class="row g-3" method="get" action="/customers">
      <div class="col-md-10">
        <label for="q" class="visually-hidden">Arama</label>
        <div class="input-group">
          <span class="input-group-text"><i class="bi bi-search"></i></span>
          <input type="text" class="form-control" id="q" name="q" placeholder="Ad, TCKN, Telefon veya E-posta ara..." value="<%= q || '' %>">
        </div>
      </div>
      <div class="col-md-2">
        <div class="d-grid gap-2">
          <button type="submit" class="btn btn-primary">Ara</button>
          <% if (q) { %>
            <a href="/customers" class="btn btn-outline-secondary">Temizle</a>
          <% } %>
        </div>
      </div>
    </form>
  </div>
</div>

<div class="table-responsive">
  <table class="table table-striped table-hover align-middle">
    <thead class="table-light">
      <tr>
        <th>Ad Soyad</th>
        <th>Telefon</th>
        <th>TCKN</th>
        <th>E-posta</th>
        <th>Doğum Tarihi</th>
        <th class="text-end">İşlem</th>
      </tr>
    </thead>
    <tbody>
      <% if (customers.length === 0) { %>
        <tr><td colspan="6" class="text-center py-4 text-muted">Kayıtlı müşteri bulunamadı.</td></tr>
      <% } %>
      <% customers.forEach(c => { %>
        <tr>
          <td>
            <a href="/customers/<%= c.id %>" class="text-decoration-none fw-bold">
              <i class="bi bi-person"></i> <%= c.name %>
            </a>
          </td>
          <td><%= c.phone || '-' %></td>
          <td><%= c.id_no || '-' %></td>
          <td><%= c.email || '-' %></td>
          <td><%= c.birth_date || '-' %></td>
          <td class="text-end">
            <div class="btn-group btn-group-sm">
              <% if (c.phone) { %>
                <a
                  href="https://wa.me/<%= String(c.phone || '').replace(/\D/g, '') %>?text=<%= encodeURIComponent('Sayın ' + (c.name || '') + ', doğum gününüzü kutlar, sağlıklı günler dileriz. Erdem KÖKENER Sigorta WİN') %>"
                  target="_blank"
                  class="btn btn-outline-success"
                  title="WhatsApp ile Mesaj Gönder"
                >
                  <i class="bi bi-whatsapp"></i>
                </a>
              <% } %>
              <a href="/customers/<%= c.id %>" class="btn btn-outline-primary" title="Detay"><i class="bi bi-eye"></i></a>
              <a href="/customers/<%= c.id %>/edit" class="btn btn-outline-warning" title="Düzenle"><i class="bi bi-pencil"></i></a>
              <form action="/customers/<%= c.id %>/delete" method="post" class="d-inline" onsubmit="return confirm('Müşteri silinecek. Emin misiniz?')">
                <button type="submit" class="btn btn-outline-danger" title="Sil"><i class="bi bi-trash"></i></button>
              </form>
            </div>
          </td>
        </tr>
      <% }) %>
    </tbody>
  </table>
</div>
